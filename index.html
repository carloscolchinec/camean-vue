<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="ZXing for JS">

  <title>ZXing TypeScript | Decoding from camera stream</title>

  <!-- Stylesheets -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-200">

  <main class="container mx-auto px-4 py-8">

    <section class="bg-white shadow-lg rounded-lg p-6">
      <h1 class="text-2xl font-semibold mb-4">Scan 1D/2D Code from Video Camera</h1>

      <p>This example shows how to scan any supported 1D/2D code with ZXing javascript library from the device video
        camera. If more
        than one video input devices are available (for example front and back camera) the example shows how to read
        them and use a select to change the input device.</p>

      <div class="flex justify-between items-center mt-4">
        <button id="startButton" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded">
          Start
        </button>
        <button id="resetButton" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded">
          Reset
        </button>
      </div>

      <div class="mt-4">
        <video id="video" width="300" height="200" style="border: 1px solid gray"></video>
        <canvas id="scanner-overlay" class="absolute top-0 left-0"></canvas>
      </div>

      <div id="sourceSelectPanel" class="mt-4 hidden">
        <label for="sourceSelect" class="font-semibold">Change video source:</label>
        <select id="sourceSelect" class="block mt-2 w-full border rounded px-4 py-2 bg-white focus:outline-none">
        </select>
      </div>

      <div class="mt-4">
        <label class="font-semibold">Result:</label>
        <pre><code id="result" class="bg-gray-100 p-2 rounded"></code></pre>
      </div>

      <p class="mt-4">See the <a href="https://github.com/zxing-js/library/tree/master/docs/examples/multi-camera/">source
          code</a>
        for this example.</p>
    </section>

    <footer class="mt-8 text-center">
      <p class="text-gray-600">ZXing TypeScript Demo. Licensed under the <a target="_blank"
          href="https://github.com/zxing-js/library#license" title="MIT">MIT</a>.</p>
    </footer>

  </main>

  <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
  <script type="text/javascript">
    window.addEventListener('load', function () {
      let selectedDeviceId;
      const codeReader = new ZXing.BrowserMultiFormatReader()
      console.log('ZXing code reader initialized')
      codeReader.listVideoInputDevices()
        .then((videoInputDevices) => {
          const sourceSelect = document.getElementById('sourceSelect')
          selectedDeviceId = videoInputDevices[0].deviceId
          if (videoInputDevices.length >= 1) {
            videoInputDevices.forEach((element) => {
              const sourceOption = document.createElement('option')
              sourceOption.text = element.label
              sourceOption.value = element.deviceId
              sourceSelect.appendChild(sourceOption)
            })

            sourceSelect.onchange = () => {
              selectedDeviceId = sourceSelect.value;
            };

            const sourceSelectPanel = document.getElementById('sourceSelectPanel')
            sourceSelectPanel.style.display = 'block'
          }

          document.getElementById('startButton').addEventListener('click', () => {
            codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
              if (result) {
                console.log(result)
                document.getElementById('result').textContent = result.text
              }
              if (err && !(err instanceof ZXing.NotFoundException)) {
                console.error(err)
                document.getElementById('result').textContent = err
              }
            })
            console.log(`Started continous decode from camera with id ${selectedDeviceId}`)
          })

          document.getElementById('resetButton').addEventListener('click', () => {
            codeReader.reset()
            document.getElementById('result').textContent = '';
            console.log('Reset.')
          })

        })
        .catch((err) => {
          console.error(err)
        })
    })
  </script>

</body>

</html>
