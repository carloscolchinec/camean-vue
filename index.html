<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Lector de Códigos de Barra</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
  <div class="p-4 max-w-md mx-auto mt-8 border rounded-lg shadow-lg">
    <h2 class="text-xl font-semibold mb-4">Lector de Códigos de Barra</h2>
  <video id="barcode-scanner" class="w-full h-auto mb-4" playsinline></video>
    <button id="switch-camera" class="bg-blue-500 hover:bg-blue-600 text-white rounded px-4 py-2">Cambiar Cámara</button>
    <div id="scanned-code" class="text-lg font-semibold mt-4"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const video = document.getElementById('barcode-scanner');
      const switchCameraButton = document.getElementById('switch-camera');

      let activeCamera = 0;

      async function switchCamera() {
        const devices = await navigator.mediaDevices.enumerateDevices();
        const videoDevices = devices.filter(device => device.kind === 'videoinput');

        if (videoDevices.length > 1) {
          activeCamera = (activeCamera + 1) % videoDevices.length;
          startScanner(videoDevices[activeCamera].deviceId);
        }
      }

      function startScanner(deviceId) {
        Quagga.init({
          inputStream: {
            name: 'Live',
            type: 'LiveStream',
            target: video,
            constraints: {
              deviceId: deviceId,
              facingMode: 'environment', // Cámara trasera (o 'user' para cámara frontal)
            },
          },
          decoder: {
            readers: ['ean_reader'],
          },
        }, function(err) {
          if (err) {
            console.error('Error al iniciar el escáner:', err);
            return;
          }

          Quagga.start();
        });

        Quagga.onDetected(function(result) {
          const code = result.codeResult.code;
          drawBoundingBox(result);
          displayScannedCode(code);
        });
      }

      function drawBoundingBox(result) {
        const drawingCtx = Quagga.canvas.ctx.overlay;
        const drawingCanvas = Quagga.canvas.dom.overlay;

        if (result) {
          const { codeResult, line } = result;
          const lineWidth = 10;

          drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute('width')), parseInt(drawingCanvas.getAttribute('height')));
          drawingCtx.strokeStyle = '#00FF00';
          drawingCtx.lineWidth = lineWidth;
          drawingCtx.beginPath();
          drawingCtx.moveTo(line[0].x, line[0].y);
          drawingCtx.lineTo(line[1].x, line[1].y);
          drawingCtx.lineTo(line[2].x, line[2].y);
          drawingCtx.lineTo(line[3].x, line[3].y);
          drawingCtx.lineTo(line[0].x, line[0].y);
          drawingCtx.stroke();
        }
      }

      function displayScannedCode(code) {
        const codeDisplay = document.getElementById('scanned-code');
        codeDisplay.textContent = code;
      }

      switchCameraButton.addEventListener('click', switchCamera);
      startScanner(null);
    });
  </script>
</body>
</html>
